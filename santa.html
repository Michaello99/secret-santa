<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Secret Santa</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: #f5f5f7;
  padding: 30px;
  transition: background 0.3s;
}
h1, h2 { text-align:center; color:#111; margin-bottom:20px; }
.container {
  max-width:600px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
}
label { font-weight:600; display:block; margin-top:15px; color:#333; }
textarea { width:100%; padding:12px; margin-top:8px; border-radius:14px; border:1px solid #d2d2d7; font-size:16px; background:#fff; transition:all 0.3s ease; }
textarea:focus { outline:none; border-color:#007aff; box-shadow:0 0 8px rgba(0,122,255,0.3); }
button { margin-top:20px; width:100%; padding:14px; border:none; border-radius:16px; background:#007aff; color:white; font-weight:600; cursor:pointer; transition:all 0.25s ease; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
button:hover { background:#005ecb; transform:translateY(-1px); box-shadow:0 6px 14px rgba(0,0,0,0.15); }
ul { padding-left:20px; }
.result { margin-top:15px; font-weight:600; color:#333; min-height:24px; }
.fadeIn { animation: fadeIn 0.4s ease forwards; opacity:0; }
@keyframes fadeIn { to { opacity:1; } }
</style>
</head>
<body>

<div class="container fadeIn">
  <h1>üéÑ Secret Santa</h1>
  <h2>Twoja wylosowana osoba:</h2>
  <p id="receiverName">≈Åadowanie...</p>

  <label>Lista prezent√≥w tej osoby:</label>
  <ul id="receiverWishlist"><li>≈Åadowanie...</li></ul>

  <label>Twoja lista prezent√≥w (‚Äûmoja lista‚Äù):</label>
  <textarea id="myWishlistInput" placeholder="Wpisz prezenty, ka≈ºdy w nowej linii"></textarea>
  <button id="saveBtn">üíæ Zapisz mojƒÖ listƒô</button>

  <div id="output" class="result"></div>
</div>

<script>
const db = firebase.firestore();
const params = new URLSearchParams(window.location.search);
const pairId = params.get("id");

const output = document.getElementById("output");
const receiverNameEl = document.getElementById("receiverName");
const receiverWishlistEl = document.getElementById("receiverWishlist");
const myWishlistInput = document.getElementById("myWishlistInput");
const saveBtn = document.getElementById("saveBtn");

if(!pairId){
  output.innerText = "‚ùå Brak ID pary w URL!";
}

// Live preview: nas≈Çuchujemy zmian w dokumencie Firestore
db.collection("pairs").doc(pairId).onSnapshot(doc=>{
  if(!doc.exists) {
    output.innerText = "‚ùå Dokument pary nie istnieje!";
    return;
  }

  const data = doc.data();

  // Wylosowana osoba
  receiverNameEl.innerText = data.receiver || "Brak danych";

  // Lista prezent√≥w wylosowanej osoby
  const wishlist = data.receiverWishlist || [];
  receiverWishlistEl.innerHTML = "";
  if(wishlist.length === 0){
    receiverWishlistEl.innerHTML = "<li>(Brak wpisanych prezent√≥w)</li>";
  } else {
    wishlist.forEach(item=>{
      const li=document.createElement("li");
      li.textContent=item;
      receiverWishlistEl.appendChild(li);
    });
  }

  // Wczytanie w≈Çasnej listy
  if(data.giverWishlist){
    myWishlistInput.value = data.giverWishlist.join("\n");
  }
});

// Zapis w≈Çasnej listy
saveBtn.addEventListener("click", async ()=>{
  const items = myWishlistInput.value.split("\n").map(i=>i.trim()).filter(Boolean);
  try{
    await db.collection("pairs").doc(pairId).update({ giverWishlist: items });
    output.innerText = "‚úÖ Twoja lista zosta≈Ça zapisana!";
  } catch(err){
    console.error(err);
    output.innerText = "‚ùå B≈ÇƒÖd zapisu listy.";
  }
});
</script>
</body>
</html>
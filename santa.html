<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Secret Santa</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<style>
body { font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; background:#f5f5f7; padding:30px; }
.container { max-width:600px;margin:auto;background:#fff;padding:25px;border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,0.1);}
h1,h2 {text-align:center;}
textarea { width:100%; padding:12px; border-radius:14px; border:1px solid #d2d2d7; margin-top:8px;}
button { margin-top:20px; width:100%; padding:14px; border:none; border-radius:16px; background:#007aff; color:white; cursor:pointer;}
ul { padding-left:20px;}
.result { margin-top:15px; font-weight:600; min-height:24px;}
</style>
</head>
<body>

<div class="container">
<h1>ğŸ„ Secret Santa</h1>
<h2>Twoja wylosowana osoba:</h2>
<p id="receiverName">Åadowanie...</p>

<label>Lista prezentÃ³w tej osoby:</label>
<ul id="receiverWishlist"><li>Åadowanie...</li></ul>

<label>Twoja lista prezentÃ³w (â€moja listaâ€):</label>
<textarea id="myWishlistInput" placeholder="Wpisz prezenty"></textarea>
<button id="saveBtn">ğŸ’¾ Zapisz mojÄ… listÄ™</button>

<div id="output" class="result"></div>
</div>

<script>
const db = firebase.firestore();
const params = new URLSearchParams(window.location.search);
const pairId = params.get("id");

const output = document.getElementById("output");
const receiverNameEl = document.getElementById("receiverName");
const receiverWishlistEl = document.getElementById("receiverWishlist");
const myWishlistInput = document.getElementById("myWishlistInput");
const saveBtn = document.getElementById("saveBtn");

if(!pairId){ output.innerText="âŒ Brak ID pary w URL!"; }

const pairDoc = db.collection("pairs").doc(pairId);

// Live preview
pairDoc.onSnapshot(doc=>{
  if(!doc.exists){ output.innerText="âŒ Dokument nie istnieje"; return; }
  const data = doc.data();
  receiverNameEl.innerText = data.receiver || "(brak)";
  receiverWishlistEl.innerHTML = "";
  const wishlist = data.receiverWishlist || [];
  if(wishlist.length===0){ receiverWishlistEl.innerHTML="<li>(brak wpisanych prezentÃ³w)</li>"; }
  else wishlist.forEach(item=>{ const li=document.createElement("li"); li.textContent=item; receiverWishlistEl.appendChild(li); });

  if(data.giverWishlist) myWishlistInput.value = data.giverWishlist.join("\n");
});

// Zapis wÅ‚asnej listy
saveBtn.addEventListener("click", async ()=>{
  const items = myWishlistInput.value.split("\n").map(i=>i.trim()).filter(Boolean);
  try{
    await pairDoc.update({ giverWishlist: items });
    output.innerText="âœ… Twoja lista zostaÅ‚a zapisana!";
  } catch(e){
    console.error(e);
    output.innerText="âŒ BÅ‚Ä…d zapisu listy";
  }
});
</script>
</body>
</html>